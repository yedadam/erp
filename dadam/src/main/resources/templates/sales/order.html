<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}" 
	layout:fragment="Content">
<head>
	<style>
		.main-table {
			border: 2px solid #0d6efd;
		}

		.main-table th {
			background-color: #e3f2fd;
			text-align: center;
			vertical-align: middle;
			font-weight: bold;
			border: 1px solid #ddd;
		}

		.main-table td {
			text-align: center;
			vertical-align: middle;
			border: 1px solid #ddd;
		}

		.detail-table {
			margin-top: 20px;
		}

		.detail-table th {
			background-color: #f8f9fa;
			text-align: center;
			font-size: 14px;
			padding: 8px;
		}

		.detail-table td {
			text-align: center;
			font-size: 14px;
			padding: 8px;
		}

		.search-container {
			margin-bottom: 20px;
		}

		.btn-group-custom {
			margin-bottom: 20px;
		}

		.tui-pagination {
			padding-bottom: 10px;
		}
		.row-selected {
    		background-color: #e6f2ff !important;
  		}	
	</style>
</head>
<body class="bg-light">
	<div class="container-fluid mt-4">
		<div class="d-flex justify-content-between align-items-center mb-3">
			<h2 class="fw-bold"> ì£¼ë¬¸ê´€ë¦¬</h2>
		</div>
		<!--ìˆ˜ì •í•˜ê¸° -->
		<!-- ìƒë‹¨ ë²„íŠ¼ ì •ë ¬ -->
			<div class="row align-items-center mb-3">
			<!-- ğŸ” ê²€ìƒ‰ì°½ ì˜ì—­ -->
			<div class="col-md-6">
				<div class="position-relative" style="max-width: 500px;">
				<div class="input-group">
					<select class="form-select" id="orderSelect" style="max-width: 30%;">
					<option value="ordCode" selected>ì£¼ë¬¸ì½”ë“œ</option>
					<option value="vdrName">ê±°ë˜ì²˜ëª…</option>
					<option value="vdrCode">ê±°ë˜ì²˜ì½”ë“œ</option>
					</select>
					<input type="text" class="form-control" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" id="orderInput" autocomplete="off">
					<button class="btn btn-outline-secondary" type="button" id="orderSearchBtn">
					<i class="fas fa-search"></i>
					</button>
				</div>

				<!-- ìë™ì™„ì„± ë¦¬ìŠ¤íŠ¸ -->
				<ul id="autoOrderList"
					class="list-group position-absolute w-100 shadow-sm"
					style="top: 100%; z-index: 1050; max-height: 200px; overflow-y: auto; display: none;">
				</ul>
				</div>
			</div>

			<!-- âœ… ë²„íŠ¼ ê·¸ë£¹ ì˜ì—­ -->
			<div class="col-md-6 text-end">
				<div class="d-flex justify-content-end flex-wrap gap-2">
				<button id="excel" class="btn btn-success">
					<i class="fas fa-pen"></i> ì—‘ì…€
				</button>
				<button id="addRow" class="btn btn-secondary">
					<i class="fas fa-eye"></i> í–‰ì¶”ê°€
				</button>
				<button id="ordupd" class="btn btn-warning">
					<i class="fas fa-save"></i> ì£¼ë¬¸ìˆ˜ì •
				</button>
				<button id="ordreg2" class="btn btn-primary">
					<i class="fas fa-pen"></i> ì£¼ë¬¸ë“±ë¡
				</button>
				<button id="deleteRow" class="btn btn-danger">
					<i class="fas fa-trash"></i> í–‰ì‚­ì œ
				</button>
				<button id="statusCheck" class="btn btn-primary">
					<i class="fas fa-trash"></i> ìƒíƒœ
				</button>
				</div>
			</div>
			</div>

		
  <!-- ê²€ìƒ‰ì°½ ì˜ì—­ -->
		<div id="orderGrid" class="mb-4"></div>
		<!-- ìƒì„¸ ë²„íŠ¼ ì •ë ¬ -->
			  <div class="row mb-3">
					
        	<div class="col-12 d-flex justify-content-end">
                <div class="btn-group-custom">
                	<button class="btn btn-secondary me-2" id="addRowdtl">
                        <i class="fas fa-pen"></i>  ìƒì„¸í–‰ì¶”ê°€
                    </button>
					<button class="btn btn-warning" id="modRowdtl">
						<i class="fas fa-eye"></i>  ìƒì„¸ìˆ˜ì •
					</button>
					<button class="btn btn-primary" id="saveRowdtl">
                        <i class="fas fa-save"></i> ìƒì„¸ì €ì¥
                    </button>
                    <button class="btn btn-danger me-2" id="delRowdtl">
                        <i class="fas fa-trash"></i> ìƒì„¸í–‰ì‚­ì œ
                    </button>
                </div>
            </div>
        </div>

		<!-- ìƒì„¸ ê·¸ë¦¬ë“œ -->
		<div id="ordDtlGrid"></div>

		<!-- í’ˆëª© ëª¨ë‹¬ -->
		<div class="modal fade" id="exampleModalToggle" tabindex="-1" aria-labelledby="exampleModalToggleLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      
      <!-- ëª¨ë‹¬ í—¤ë” -->
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalToggleLabel">í’ˆëª© ì„ íƒ</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- ëª¨ë‹¬ ë°”ë”” -->
      <div class="modal-body">
        <!-- ê²€ìƒ‰ì°½ -->
        <div class="position-relative mb-3" style="max-width: 500px;">
          <div class="input-group">
            <select class="form-select" id="itemSelect" style="max-width: 30%;">
              <option value="itemCode" selected>ì•„ì´í…œì½”ë“œ</option>
              <option value="name">ì•„ì´í…œëª…</option>
            </select>
            <input type="text" class="form-control" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" id="itemInput" autocomplete="off">
            <button class="btn btn-outline-secondary" type="button" id="itemSearchBtn">
              <i class="fas fa-search"></i>
            </button>
          </div>

          <!-- ìë™ì™„ì„± ë¦¬ìŠ¤íŠ¸ -->
          <ul id="autoitemList"
              class="list-group position-absolute w-100 shadow-sm"
              style="top: 100%; z-index: 1050; max-height: 200px; overflow-y: auto; display: none;">
          </ul>
        </div>

        <!-- ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ -->
        <div id="itemList"></div>
      </div>

      <!-- ëª¨ë‹¬ í‘¸í„° -->
      <div class="modal-footer">
        <button class="btn btn-primary" data-bs-target="#exampleModalToggle2" data-bs-toggle="modal" data-bs-dismiss="modal">
          í’ˆëª© ì„ íƒ
        </button>
      </div>
    </div>
  </div>
</div>
	

		<!-- ê±°ë˜ì²˜ ëª¨ë‹¬ 1 -->
		 <div class="modal fade" id="vdrModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-xl">
				<div class="modal-content">
					<div class="modal-body">
					<!--ê²€ìƒ‰ì°½-->
						<div class="position-relative mt-4 mb-0" style="max-width: 500px;">
						    <div class="input-group">
						        <select class="form-select col-4" id="vdrSelect" style="max-width: 30%;">
						            <option value="vdrCode" selected>ê±°ë˜ì²˜ì½”ë“œ</option>
						            <option value="vdrName">ê±°ë˜ì²˜ëª…</option>
						        </select>
						        <input type="text" class="form-control" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" id="vdrInput" autocomplete="off">
						        <button class="btn btn-outline-secondary" type="button" id="vdrSearchBtn">
						            <i class="fas fa-search"></i>
						        </button>
						    </div>
						
						    <!-- ìë™ì™„ì„± ë¦¬ìŠ¤íŠ¸ -->
						    <ul id="autoVdrList"
						        class="list-group position-absolute w-100 shadow-sm"
						        style="top: 100%; z-index: 1050; max-height: 200px; overflow-y: auto; display: none;">
						    </ul>
						</div>
					</div>
						<!--ê²€ìƒ‰ì°½ ë -->
					<div id="vdrList"></div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>  

		<!-- ê±°ë˜ì²˜ ëª¨ë‹¬ 2 -->
		<div class="modal fade" id="vdrmymodal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-xl">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="exampleModalLabel">ê±°ë˜ì²˜ëª©ë¡</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div id="vdrList"></div>
					<div class="modal-body">
						<div class="row card">
							<div class="form-floating mb-3">
								<input type="date" class="form-control" id="floatingInput" placeholder="ë‚ ì§œ ì„ íƒ">
								<label for="floatingInput">ì¼ì</label>
							</div>
						</div>
						<div class="container-fluid">
							<div id="modal"></div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<!-- ê±°ë˜ì²˜ ëª¨ë‹¬ 3 -->
		<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-xl">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="exampleModalLabel">ê±°ë˜ì²˜ëª©ë¡</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div id="vdrList"></div>
					<div class="modal-body">
						<div class="row card">
							<div class="form-floating mb-3">
								<input type="date" class="form-control" id="floatingInput" placeholder="ë‚ ì§œ ì„ íƒ">
								<label for="floatingInput">ì¼ì</label>
							</div>
						</div>
						<div class="container-fluid">
							<div id="modal"></div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>


	</div>
</body>
<script th:inline="javascript">
	//íƒ€ì„ë¦¬í”„ 
	let vdrAll; //ëª¨ë“  vdrì„ë‹´ëŠ” ë¦¬ìŠ¤íŠ¸ 
	let newOrdRowNo; //
	let newNo; // dtl ì£¼ë¬¸ì‹ ê·œí–‰ì„ ì¶”ê°€í–ˆì„ë•Œ ë°›ì•„ì˜¤ëŠ” í–‰ë²ˆí˜¸
	let newItemInfoList = new Map(); //[{1:['itemCode''name','price',],2:{}] 
	let orderTotprice = new Map(); //[1:['totprice','discPrice'],2:['totPrice','discPrice']]  orderDtlì˜ ì´ê¸ˆì•¡ê³¼ í• ì¸ê¸ˆì•¡ì„ ê°€ì ¸ì˜´ 
	let vdrdiscount; //ê±°ë˜ì²˜í• ì¸ìœ¨
	let newOrdPlus; //ìƒë‹¨í—¤ë”ì—ì„œ  ìƒˆë¡œì¶”ê°€í•œ í–‰ë²ˆí˜¸
	let newDtlList = []; //[] ìƒˆë¡œìš´ ì£¼ë¬¸ìƒì„¸ í–‰ë²ˆí˜¸ë¥¼ ë°›ì•„ì˜´  
	let pageStatus='search'; //í˜ì´ì§€ ê¸°ë³¸ê°’ searchë¡œ ë‘ê¸° 


	var payMethod = /*[[${payMethod}]]*/ [];
	var ordStatus = /*[[${status}]]*/ [];  
	var itemType = /*[[${itemType}]]*/ [];  

	orderList(); //ì£¼ë¬¸ì¡°íšŒ  
	itemList(); //ì œí’ˆì¡°íšŒ 
	vdrList(); //ê±°ë˜ì²˜ì¡°íšŒ
	
	$('#statusCheck').on('click',function(){
		console.log('ìƒíƒœí™•ì¸í´ë¦­ë¨');
	//console.log(orderGrid.getData()); 
	//console.log('pageStatus',pageStatus);
    //console.log(itemType);
		console.log('ordDtl=>',ordDtlGrid.getModifiedRows());
		console.log('main=>',orderGrid.getModifiedRows()); 

	})


		//ìë™ì™„ì„±ê¸°ëŠ¥
	$('#vdrInput').on('keyup',ev => {
		 setupAutocomplete({
			    inputSelector: '#vdrInput',                              //ì¸í’‹ì— ê²ìƒ‰ê°’
			    selectSelector: $('#vdrSelect  option:selected').val(),  //selected ê²°ê³¼ê°’
			    listSelector: '#autoVdrList',                            //ìë™ì™„ì„± ë˜ëŠ”ê°’ 
			    ajaxUrl: '/erp/standard/venderAll'                     //ajaxurl
		 });
	});
	$('#vdrInput').on('keyup',ev => {
		if(ev.keyCode ==13){
			let type = $("#vdrSelect option:selected").val();
			let value = $("#vdrInput").val();
			let url ='/erp/standard/venderAll';
			let grid = vdrGrid
			commonSearch(type,value,url,grid);
		}
	})
		//ì•„ì´í…œ ê²€ìƒ‰ ìë™ì™„ì„±
	$('#itemInput').on('keyup',ev => {
		 setupAutocomplete({
			    inputSelector: '#itemInput',                              //ì¸í’‹ì— ê²ìƒ‰ê°’
			    selectSelector: $('#itemSelect  option:selected').val(),  //selected ê²°ê³¼ê°’
			    listSelector: '#autoitemList',                            //ìë™ì™„ì„± ë˜ëŠ”ê°’ 
			    ajaxUrl: '/erp/sales/itemAll'                     //ajaxurl
		 });
	});
	$('#itemInput').on('keyup',ev => {
		if(ev.keyCode ==13){
			let type = $("#itemSelect option:selected").val();
			let value = $("#itemInput").val();
			let url ='/erp/sales/itemAll';
			let grid = itemGrid
			commonSearch(type,value,url,grid);
		}
	})
	//order 
	$('#orderInput').on('keyup',ev => {
		 setupAutocomplete({
			    inputSelector: '#orderInput',                              //ì¸í’‹ì— ê²ìƒ‰ê°’
			    selectSelector: $('#orderSelect  option:selected').val(),  //selected ê²°ê³¼ê°’
			    listSelector: '#autoOrderList',                            //ìë™ì™„ì„± ë˜ëŠ”ê°’ 
			    ajaxUrl: '/erp/sales/orderList'                     
		 });
	});
	$('#orderInput').on('keyup',ev => {
		if(ev.keyCode ==13){
			let type = $("#orderSelect option:selected").val();
			let value = $("#orderInput").val();
			let url ='/erp/sales/orderList';
			let grid = orderGrid
			commonSearch(type,value,url,grid);
		}
	})	
	//setTimeout(); //ì´ˆê¸°ì„¤ì •
	const orderGrid = new tui.Grid({
		//toastui ì•„ì´ë”” ê°€ì ¸ì˜¤ê¸°
		el: document.getElementById('orderGrid'),
		//checkboxë¶€ì—¬
		rowHeaders: ['checkbox'],
		//editingEvent: 'click',	
		//í˜ì´ì§€ë„¤ì´ì…˜
		pageOptions: {
			perPage: 5,
			useClient: true,
		},
		//í•„ë“œê°’ êµ¬ì„±
		columns: [
			{header: 'ì£¼ë¬¸ë²ˆí˜¸',name: 'ordCode',	align: 'center',width: 100,	},
			{header: 'ë“±ë¡ì¼ì',name: 'createdDate',align: 'center',	editor: 'datePicker'},
			{header: 'ê±°ë˜ì²˜ì´ë¦„',name: 'vdrName',	align: 'center'},
			{header: 'ê±°ë˜ì²˜ì½”ë“œ',name: 'vdrCode',align: 'center'},
			{header: 'ë‚©ê¸°ì¼ì',name: 'reqDlvDate',align: 'center',editor: 'datePicker'},
			{header: 'ì´ê¸ˆì•¡',	name: 'totPrice',	align:'right',
				formatter: ({ value }) => (value == null || value === 0) ? '' : value.toLocaleString() + 'ì›',
				},
			{header: 'ì—¬ì‹ í•œë„',name: 'creditPrice',align:'right', 
				formatter: ({ value }) => (value == null || value === 0) ? '' : value.toLocaleString() + 'ì›',
				},
			{header: 'ì—¬ì‹ ì”ì•¡',name: 'creditBalPrice',	align:'right',
				formatter: ({ value }) => (value == null || value === 0) ? '' : value.toLocaleString() + 'ì›', 	
			},
			{header: 'ì§€ë¶ˆë°©ì‹',	name: 'payMethod',align: 'center',
				formatter: 'listItemText',	
				editor: {type: 'select',
						 		 options: {listItems: payMethod}
						}//Mapí˜•íƒœë¡œ ë‹´ì•„ì˜´ [{"text":"","value":""}]
			},
			{header: 'ì§„í–‰ìƒíƒœ',name: 'status',align: 'center',
				formatter:'listItemText',
				editor: {type: 'select',options: {listItems: ordStatus}
			}
			}, 
			{header: 'í• ì¸ìœ¨',name: 'discount',align: 'center',
				formatter: function (discount) {
					if (discount.value == null) {
						return discount.value = ' ';
					} else if (discount.value != null) {
						return discount.value = discount.value + '%';
					}
				}
			}
		],
	});

	let  selectedRowKey; 
	orderGrid.on('click', (ev) => {
		
		//ì´ ì „ì— ì„ íƒí•œ í–‰ ìƒ‰ê¹”ì´ ì›ë˜ëŒ€ë¡œ ëŒì•„ì˜´ 
		orderGrid.removeRowClassName(selectedRowKey,'row-selected'); 
		selectedRowKey=ev.rowKey; 
		orderGrid.addRowClassName(ev.rowKey,'row-selected'); 

	//ë“±ë¡ì¤‘ì¸ í–‰ì„ í´ë¦­í•˜ë‹¤ê°€ ë‹¤ë¥¸í–‰í´ë¦­í–ˆë‹¤ê°€ ë‹¤ì‹œê°”ì„ë•Œ Dtl gridê°€ reset ë¨    
	//	if (orderGrid.getCheckedRows()[0].ordCode == null ||
	//		orderGrid.getCheckedRows()[0].reqDlvDate == null &&
	//		orderGrid.getCheckedRows()[0].status == null &&
	//		orderGrid.getData()[ev.rowKey].totPrice == null) {
	//		ordDtlGrid.resetData([{}]);
	//	}


		const checkedRows = orderGrid.getCheckedRowKeys();	 	

		if (checkedRows.length > 1 || checkedRows[0] !== ev.rowKey) {
				orderGrid.uncheckAll(); // ì „ì²´ í•´ì œ
				orderGrid.check(ev.rowKey); // í˜„ì¬ í–‰ë§Œ ì²´í¬
		}
		if (ev.columnName == "vdrCode" || ev.columnName == "vdrName") {
			openVdrmodal();
		
		} //ëª¨ë‹¬ì—´ê¸°
		const rowData = orderGrid.getRow(ev.rowKey);
		if (rowData && rowData.ordCode?.trim()) {
			if(pageStatus=='search'){
				ordDtlList(rowData.ordCode);
			}
		}
		let headTotPrice = 0;
		//nullê°’ ë°©ì§€ 
		for (let i = 0; i < ordDtlGrid.getData().length; i++) {
				if (ordDtlGrid.getData()[i].ordCode == null) {
					ordDtlGrid.setValue(i, "ordCode", orderGrid.getRow(ev.rowKey).ordCode);
				}
				if (ordDtlGrid.getData()[i].quantity == null) {
					ordDtlGrid.setValue(i, "quantity", 1); //ìˆ˜ëŸ‰nullê°’ ì´ë©´ default 1ë¡œ ë¶€ì—¬í•˜ê¸°ë¡œí•¨   
				}
				ordDtlGrid.setValue(i, "totPrice",
					ordDtlGrid.getData()[i].supPrice +
					ordDtlGrid.getData()[i].vatPrice -
					ordDtlGrid.getData()[i].discPrice);
			//	console.log('ordDtlGrid.getData(i)', ordDtlGrid.getData()[i]);
				headTotPrice += ordDtlGrid.getData()[i].totPrice;
		}
		//	orderGrid.setValue(ev.rowKey,"totPrice",headTotPrice); //í—¤ë” ì£¼ë¬¸ë²ˆí˜¸ë¥¼ í´ë¦­í•˜ë©´ ì´ê¸ˆì•¡ì´ ìƒì„¸ë‚´ì—­ì˜ ì´ê¸ˆì•¡ì„ ê°ê°í•©í•˜ì—¬ í—¤ë”ì— ë‚˜íƒ€ë‚¨  
		console.log(ordDtlGrid.getData());
		//nullê°’ ë°©ì§€
		console.log('nullê°’ ë°©ì§€', ordDtlGrid.getData());
	})
	orderGrid.on('afterChange', ev => {
		if (ev.changes[0].columnName == 'vdrCode') {
			let vdrCode = ev.changes[0].value; //ê±°ë˜ì²˜ë²ˆí˜¸  
			for (let i = 0; i < vdrAll.length; i++) { //[{},{},{}] ê±°ë˜ì²˜ë¦¬ìŠ¤íŠ¸ì¤‘ì— í•´ë‹¹í•˜ëŠ” 
				console.log(vdrAll.length);
				if (vdrAll[i].vdrCode == vdrCode) {
					orderGrid.setValue(ev.changes[0].rowKey, "vdrName", vdrAll[i].vdrName); //ì´ë¦„ 
					orderGrid.setValue(ev.changes[0].rowKey, "creditPrice", vdrAll[i].creditPrice); //ì—¬ì‹ ê°€ê²© 
					orderGrid.setValue(ev.changes[0].rowKey, "creditBalPrice", vdrAll[i].creditBalPrice); //ì—¬ì‹ ì”ì•¡ 
					orderGrid.setValue(ev.changes[0].rowKey, "discount", vdrAll[i].discount); //í• ì¸ìœ¨ 
					vdrdiscount = vdrAll[i].discount / 100; //ê±°ë˜ì²˜ ì¶”ê°€í• ë•Œ í• ì¸ìœ¨ì„ ë³€ìˆ˜ë¡œ ì§€ì •í•´ì„œ ë°›ì•„ì˜´ 
				}
			}
		}
	})
	//ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ë°›ì•„ì™€ì„œ ìƒì„¸í’ˆëª© ì¡°íšŒí›„ í…Œì´ë¸” ìƒì„±í•˜ëŠ” í•¨ìˆ˜ 	
	// ordDtlGrid.resetData(result);
	let ordDtlGrid = new tui.Grid({
		el: document.getElementById('ordDtlGrid'),
		rowHeaders: ['checkbox'],
		columns: [
			{header: 'ì£¼ë¬¸ìƒì„¸ì •ë³´',name: 'ordDtlCode',	align: 'center',width: 110},
			{header: 'í’ˆëª©ì½”ë“œ',name: 'itemCode',align: 'center',editor:'text',width:100},
			{header: 'í’ˆëª©ëª…',name: 'name',align: 'left',resizable: true,},
			{header: 'ë‹¨ê°€',name: 'price',	align: 'right',
				formatter: ({ value }) => (value == null || value === 0) ? '' : value.toLocaleString() + 'ì›',},
			{header: 'ìˆ˜ëŸ‰',name: 'quantity',align: 'center',	
			 	formatter: ({value }) => (value == null || value === 0) ? '' : value.toLocaleString() + 'ê°œ',
				editor: 'text'},
			{header: 'ê³µê¸‰ê°€ì•¡',name: 'supPrice',align: 'right',
			 	formatter: ({value}) => (value == null || value === 0) ? '' : value.toLocaleString() + 'ì›'},
			{header: 'ë¶€ê°€ì„¸',name: 'vatPrice',	align: 'right',
				formatter: ({value}) => (value == null || value === 0) ? '' : value.toLocaleString() + 'ì›'},
			{header: 'í• ì¸ê¸ˆì•¡',name: 'discPrice',	align: 'right',	
				formatter: ({value}) => (value == null || value === 0) ? '' : value.toLocaleString() + 'ì›'}, 
			{header: 'ì´ê°€ê²©',name: 'totPrice',	align: 'right',
				formatter: ({value}) => (value == null || value === 0) ? '' : value.toLocaleString() + 'ì›',
				editor:'text'}
		]
	})
	//ì•„ì´í…œ ëª¨ë‹¬ì•ˆì— ì•„ì´í…œê·¸ë¦¬ë“œ ìƒì„±  
	let itemGrid = new tui.Grid({
		el: document.getElementById('itemList'), //ì•„ì´í…œê·¸ë¦¬ë“œ ì•„ì´ë”” ì°¾ê¸° 
		rowHeaders: ['checkbox'], //ì²´í¬ë°•ìŠ¤ 
		pageOptions: {
			perPage: 10, //10ê°œì”© ë³´ì—¬ì£¼ê¸° 
			useClient: true,
		},
		columns: [
			{header: 'ì¢…ë¥˜', name: 'type',align: 'center',
				formatter: ({ value }) => formatItemType(value)},
			{header: 'í’ˆëª©ì½”ë“œ',name: 'itemCode',align: 'center'},
			{header: 'í’ˆëª©ëª…',name: 'name',align: 'left'},
			{header: 'ê°€ê²©',name: 'price',align:'right',
				formatter: ({ value }) => (value == null || value === 0) ? '' : value.toLocaleString() + 'ì›'		
		}
		]
	})
	//vdr ëª¨ë‹¬ì•ˆì—  vdrGrid ìƒì„±  
	let vdrGrid = new tui.Grid({
		el: document.getElementById('vdrList'),
		rowHeaders: ['checkbox'], //ì²´í¬ë°•ìŠ¤
		pageOptions: {
			perPage: 10,
			useClient: true,
		},
		columns: [
			{header: 'ê±°ë˜ì²˜ì½”ë“œ',name: 'vdrCode',align: 'center'},
			{header: 'ê±°ë˜ì²˜ëª…',name: 'vdrName',align: 'center'},
			{header: 'ì—¬ì‹ í•œë„',name: 'creditPrice',align: 'center',
				formatter: ({ value }) => (value == null || value === 0) ? '' : value.toLocaleString() + 'ì›'
			},
			{header: 'ì—¬ì‹ ì”ì•¡',name:'creditBalPrice',align: 'center',
					formatter: ({ value }) => (value == null || value === 0) ? '' : value.toLocaleString() + 'ì›'
			},
			{header: 'í• ì¸ìœ¨',name:'discount',align: 'center',
					formatter: ({ value }) => (value == null || value === 0) ? '' : value.toLocaleString() + '%'
			}
		]
	})
	vdrGrid.on('click', (ev) => {
		console.log('ìƒˆë¡œì¶”ê°€ëœ í–‰ì˜ë²ˆí˜¸', newOrdPlus);
		const checkedRows = vdrGrid.getCheckedRowKeys();
		if (checkedRows.length > 1 || checkedRows[0] !== ev.rowKey) {
			vdrGrid.uncheckAll(); // ì „ì²´ í•´ì œ
			vdrGrid.check(ev.rowKey); // í˜„ì¬ í–‰ë§Œ ì²´í¬
		}
		const rowData = vdrGrid.getRow(ev.rowKey); //í–‰
		const rowNo = orderGrid.getCheckedRowKeys()
		console.log('rowNo', rowNo[0]);
		console.log(rowData);
		orderGrid.setValue(rowNo[0], 'discount', rowData.discount);
		orderGrid.setValue(rowNo[0], 'creditPrice', rowData.creditPrice);
		orderGrid.setValue(rowNo[0], "creditBalPrice", rowData.creditBalPrice);
		orderGrid.setValue(rowNo[0], "vdrName", rowData.vdrName);
		orderGrid.setValue(rowNo[0], "vdrCode", rowData.vdrCode);
		vdrdiscount = rowData.discount / 100; //ê±°ë˜ì²˜ ì¶”ê°€í• ë•Œ í• ì¸ìœ¨ì„ ë³€ìˆ˜ë¡œ ì§€ì •í•´ì„œ ë°›ì•„ì˜´

		const vdrModalInstance = bootstrap.Modal.getInstance(document.getElementById('vdrModal'));
		if (vdrModalInstance) {
			vdrModalInstance.hide();
		}

	})
	//item í•­ëª© ì„ íƒ í–ˆì„ë•Œ í•­ëª© ì ìš© newItemInfoList ì— ì¶”ê°€í•  í’ˆëª©ê³¼ í•´ë‹¹ í–‰ì˜ ë²ˆí˜¸ê°€ ëª¨ë‘ ì €ì¥ë¨ 
	itemGrid.on('click', (ev) => {
		//	console.log(ev); 
		console.log('ì‹ ê·œ ì¶”ê°€ëœ í•´ë‹¹ í–‰', newNo); // í–‰ì¶”ê°€í• ë•Œë§ˆë‹¤ newNoëŠ” ê³„ì† ë°”ë€œ 
		newDtlList.push(newNo); //ë“±ë¡í• ë•Œ ë°°ì—´ì— ë‹´ê¹€ 
		//console.log(newDtlList);   
		const checkedRows = itemGrid.getCheckedRowKeys(); //ì•„ì´í…œê·¸ë¦¬ë“œ ì²´í¬ëœ í–‰ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
		if (checkedRows.length > 1 || checkedRows[0] !== ev.rowKey) {
			itemGrid.uncheckAll(); // ì „ì²´ í•´ì œ
			itemGrid.check(ev.rowKey); // í˜„ì¬ í–‰ë§Œ ì²´í¬
		}
		const rowData = itemGrid.getRow(ev.rowKey); //í–‰ì˜ ê°’ì„ ê°€ì ¸ì˜´ {itemCode:"item-101"}
		let newitemInfo = itemInfo(rowData.itemCode, rowData.name, rowData.price); //itemInfoê°’ ë°˜í™˜
		newItemInfoList.set(newNo, newitemInfo); //í’ˆëª©ì¶”ê°€ëœ ì •ë³´ë¥¼ ê³„ì† ë‹´ìŒ   
		console.log(newItemInfoList); //ìƒˆë¡œ ì¶”ê°€í•œ í–‰ì˜ ì•„ì´í…œ ì •ë³´ì˜ í–‰ê³¼ ì•„ì´í…œì •ë³´ ì €ì¥í•¨ {1:[itemCode,name,price],2:[]}

		ordDtlGrid.setValue(newNo, "itemCode", rowData.itemCode);
		ordDtlGrid.setValue(newNo, "name", rowData.name);
		ordDtlGrid.setValue(newNo, "price", rowData.price); // 
		ordDtlGrid.setValue(newNo, "supPrice", rowData.price); //ê³µê¸‰ê°€ì•¡ 
		ordDtlGrid.setValue(newNo, "vatPrice", rowData.price / 10); //ë¶€ê°€ì„¸ 
		ordDtlGrid.setValue(newNo, "totPrice", rowData.price + rowData.price / 10); //ì´ê°€ê²© ì•„ì´í…œ ì„ íƒì‹œ ê¸°ë³¸ì„¸íŒ… ìˆ˜ëŸ‰ 1ê¸°ì¤€ìœ¼ë¡œ ìë™ì…ë ¥ë¨
		ordDtlGrid.setValue(newNo, "discPrice", (rowData.price + rowData.price / 10) * vdrdiscount); // ì´ê¸ˆì•¡ * í• ì¸ìœ¨  

		const itemModalInstance = bootstrap.Modal.getInstance(document.getElementById('exampleModalToggle'));
		if (itemModalInstance) {
			itemModalInstance.hide();
		}
	});
	//ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
	function orderList() {
		$.ajax({
			url: "/erp/sales/orderList",
			method: "GET",
			success: function (result) {
				//console.log('ì£¼ë¬¸ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°', result);
				console.log(result);
				orderGrid.resetData(result);
			}
		})
	}
	//ë©”ì¸ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° 
	function mainList(){
		pageStatus='search'; 
		orderList(); //ì¡°íšŒë‹¤ì‹œ í•˜ê¸° 
	}

	//ì£¼ë¬¸ë²ˆí˜¸ì— í•´ë‹¹í•˜ëŠ” ìƒì„¸ì •ë³´ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
	function ordDtlList(ordcode) {
		$.ajax({
			url: "/erp/sales/ordDtlList",
			method: "GET",
			data: {
				ordCode: ordcode
			},
			success: function (result) {
				//console.log('ì£¼ë¬¸ìƒì„¸ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°', result);
				ordDtlGrid.resetData(result);
				console.log('ìƒì„¸ì •ë³´ì¡°íšŒ',result);
			}
		})
	}
	//ì•„ì´í…œë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜  
	function itemList() {
		$.ajax({
			url: "/erp/sales/itemAll",
			method: "GET",
			success: function (result) {
				//	console.log(result);
				itemGrid.resetData(result);
			}
		})
	}

	function vdrList() { //ê±°ë˜ì²˜ë¦¬ìŠ¤íŠ¸ì¡°íšŒ 
		$.ajax({
			url: "/erp/sales/venderAll",
			method: "GET",
			success: function (result) {
				vdrAll = result;
				console.log(vdrAll);
				vdrGrid.resetData(result);
				console.log(vdrAll);
			}
		})
	}
	let ordDtlForm;
	$('#addRow').on('click', function () {
		orderGrid.uncheckAll();

		console.log(orderGrid.getData()[0].ordCode); //ordCode ord-122 ì´ëŸ°ê¼´ë¡œ ë‚˜ì˜´ 
		let nextordCode = orderGrid.getData()[0].ordCode;  // ì˜ˆ: "ord-122"
		let numberOnly = String(Number(nextordCode.substr(4))+1);     
		pageStatus='register'; //ë“±ë¡ìƒíƒœ
	  	nextordCode='ord-'+numberOnly; //ord-123    

		//í–‰ì¶”ê°€í•  ë°ì´í„° ìƒì„±
		let addRow = {}
		let addDtlRow={}
		orderGrid.prependRow(addRow);
		ordDtlGrid.resetData([{}]); //í–‰ì¶”ê°€ í•  ê²½ìš° ë””í…Œì¼ê·¸ë¦¬ë“œì— í–‰ì´ ê¸°ë³¸ìœ¼ë¡œ í•˜ë‚˜ ì¶”ê°€ë¨ 
		const rowCount = orderGrid.getRowCount(); // ì „ì²´ í–‰ ìˆ˜
		const newRow = orderGrid.getRow(rowCount - 1); // ë§ˆì§€ë§‰ í–‰ ë°ì´í„°
	
		newOrdPlus = newRow.rowKey; //ìƒˆë¡œì¶”ê°€ëœ í–‰ë²ˆí˜¸ ì •ì˜

		orderGrid.refreshLayout();
	
		orderGrid.check(newOrdPlus); //ìƒˆë¡œì¶”ê°€ëœ í–‰ì— ì²´í¬
	
		orderGrid.setValue(newOrdPlus, "createdDate", dateformatyymmdd(new Date()));
		orderGrid.setValue(newOrdPlus, "status", "ost01");
		orderGrid.setValue(newOrdPlus,"ordCode",nextordCode); //nextordCode
	})
	$('#deleteRow').on('click', function () {


	//ì£¼ë¬¸ì‚­ì œí•  ê²½ìš° ì¶œí•˜ìš”ì²­ì´ ì™„ë£Œëœ ìƒí’ˆì¼ ê²½ìš° ê²½ê³ ì°½ ë„ìš°ê¸° 	
	 if(orderGrid.getData()[orderGrid.getCheckedRowKeys()[0]].status=='ost02'||orderGrid.getData()[orderGrid.getCheckedRowKeys()[0]].status=='ost03' ){
		 Swal.fire('ì‹¤íŒ¨','ì´ë¯¸ ì¶œí•˜ìš”ì²­ëœ ì£¼ë¬¸ê±´ì…ë‹ˆë‹¤','error');
			return;
		} 

		//ì²´í¬ëœí–‰ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜	
		const checkedRows = orderGrid.getCheckedRows();
		//console.log('í–‰ì‚­ì œ',checkedRows)
		checkedRows.forEach(item => {
			//console.log(item.ordCode);
			if (item.status != 'ost03') { //ì¶œê³ ì™„ë£Œ ëœê±´ì´ ì•„ë‹Œê²ƒë§Œ ì‚­ì œê°€ëŠ¥  
				orderGrid.removeRow(item.rowKey);
				$.ajax({
					url: "/erp/sales/ord/delete?ordCode=" + item.ordCode, // URLì— ordCodeë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì¶”ê°€
					method: "DELETE",
					success: function (result) {
						console.log('ì‚­ì œì™„ë£Œ');
							Swal.fire({
										title: "ì‚­ì œì™„ë£Œ!",
										icon: "success",
										draggable: true
										});
					}
				});
			} 
		})
	})
	//ì£¼ë¬¸ìƒì„¸ í–‰ì¶”ê°€ ë°˜ì˜ 
	$('#addRowdtl').on('click', function () {
	//	orderGrid.uncheckAll(); 
		let addDtlrow = {} //		
		ordDtlGrid.appendRow(addDtlrow); //
		ordDtlGrid.refreshLayout(); //
	})
	//ìƒˆë¡œìš´í–‰ë²ˆí˜¸ ì„ ì–¸
	ordDtlGrid.on('click', (ev) => {
		newNo = ordDtlrowNo(ev.rowKey); //ordDtlrow 
		ev.columnName == 'itemCode' ? openItemmodal() : console.log('ì•„ì´í…œëª¨ë‹¬ì•ˆì—´ë¦¼');
		const checkedRows = ordDtlGrid.getCheckedRowKeys();
	
	})
	$('#ordreg2').on('click', function () {
		console.log('rderGrid.getModifiedRows().createdRows[0])',orderGrid.getModifiedRows().createdRows[0]); 
		console.log('orderGrid.getCheckedRows()[0]', orderGrid.getCheckedRows()[0]); 
		let regHeader =orderGrid.getModifiedRows().createdRows[0]; //ì²´í¬í‘œì‹œ êµ³ì´ ì•ˆí•´ë„ ì£¼ë¬¸ë“±ë¡ê°€ëŠ¥  
		// â— ì£¼ë¬¸ í—¤ë” ìœ íš¨ì„± ê²€ì‚¬
		if (!regHeader.vdrCode || !regHeader.payMethod || !regHeader.status) {
			Swal.fire({
				icon: "error",
				title: "error",
				text: "í•„ìˆ˜í•­ëª©ê¸°ì…í•˜ì‹œì˜¤"
			});
			return;
		}
		//ì—¬ì‹ ì”ì•¡ì´ ì—†ëŠ”ê²½ìš°
		if (regHeader.creditBalPrice <= 0) {
			Swal.fire({
				icon: "error",
				title: "error",
				text: "ì—¬ì‹ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤"
			});
			return;
		}
		regHeader.empId = userID;
		regHeader.comId = userComId;
		const dtlObj = ordDtlGrid.getModifiedRows(); 
		let totSup=0; 
		let totVat=0; 
		let totDisc=0;
		let qty=0; 
		for(let i=0; i<dtlObj.createdRows.length;i++ ){
			totSup+=dtlObj.createdRows[i].supPrice; //ì´ ê³µê¸‰ê°€ì•¡ 
			totVat+=dtlObj.createdRows[i].vatPrice; //ì´ë¶€ê°€ì„¸
			totDisc+=dtlObj.createdRows[i].discPrice; // ì´í• ì¸ê¸ˆì•¡	
			qty+=dtlObj.createdRows[i].quantity; //ì´ìˆ˜ëŸ‰  
		}
			regHeader.totSupPrice=totSup;
			regHeader.totVatPrice=totVat; 
			regHeader.totDisc=totDisc; 
			regHeader.totQuantity=qty; 

	//console.log('dtlObj',dtlObj);   
		const dataToSend = {
			ord: regHeader, // ì¼ë°˜ ê°ì²´ {}
			dtl: dtlObj     // [{},{}]
		};
		console.log('dataToSend',dataToSend);
		$.ajax({
			url: '/erp/sales/ord/register',
			type: 'POST',
			contentType: 'application/json',
			data: JSON.stringify(dataToSend),
			success: function (res) {
				console.log('ì „ì†¡ ì„±ê³µ', res);
				Swal.fire({
					title: "ì£¼ë¬¸ë“±ë¡ì„±ê³µ!",
					icon: "success",
					draggable: true
				});
				
				orderList(); //ì£¼ë¬¸ë“±ë¡í•˜ê³  ë‹¤ì‹œ ì£¼ë¬¸ë¦¬ìŠ¤íŠ¸ 
				pageStatus='search'; //pageìƒíƒœ ì¡°íšŒ ìƒíƒœë¡œ ë˜ëŒë¦¬ê¸° 
				orderGrid.uncheckAll();
				ordDtlGrid.resetData(); 
			}
		})
	})
	//ì£¼ë¬¸ ìƒì„¸ ì €ì¥
	$('#saveRowdtl').on('click', function(){
		//validation ì²´í¬ 
		let test = ordDtlGrid.getData();
		//ìœ íš¨ì„± ì²´í¬ 
		$.each(test, (idx, item) => {
			if (item.itemCode == null || item.quantity == null) {
				Swal.fire({
					title: "í•„ìš”í•­ëª©ì„ ëª¨ë‘ì…ë ¥í•˜ì„¸ìš”!",
					icon: "error",
					draggable: true
				});
				return false;
			}
		})
		dtlObj=ordDtlGrid.getModifiedRows(); 
		for(let i=0; i<dtlObj.createdRows.length;i++){
			dtlObj.createdRows[i].ordCode=
			orderGrid.getCheckedRows()[0].ordCode;
		}
		regHeader =orderGrid.getCheckedRows()[0]; 
		console.log('dtlObj ordCode í™•ì¸ : ',dtlObj); 	
		const dataToSend = {
			ord: regHeader, // ì¼ë°˜ ê°ì²´
			dtl: dtlObj
		};

		$.ajax({
			url: '/erp/sales/ord/regDtl',
			type: 'POST',
			contentType: 'application/json',
			data: JSON.stringify(dataToSend),
			success: function (res) {
				console.log('ì „ì†¡ ì„±ê³µ', res);
				Swal.fire({
					title: "ì €ì¥ì„±ê³µ!",
					icon: "success",
				draggable: true
				});
			}
		})	
	})
	//ì£¼ë¬¸ ìˆ˜ì •
	$('#ordupd').on('click', function () {
		console.log(orderGrid.getCheckedRows());
		let updHeader = orderGrid.getCheckedRows()[0]; //ë‚©ê¸°ì¼ì,ì§€ë¶ˆë°©ì‹ {ordCode:"ord-129",payMethod:"opm01"}
		updHeader.updateId = userID; //update
		$.ajax({
			url: '/erp/sales/ord/update',
			type: 'PUT',
			contentType: 'application/json',
			data: JSON.stringify(updHeader),
			success: function (res) {
				console.log('ì „ì†¡ ì„±ê³µ', res);
				Swal.fire({
					title: "ì£¼ë¬¸ìˆ˜ì •ì„±ê³µ!",
					icon: "success",
					draggable: true
				});
				orderGrid.uncheckAll();
			}
		})
	})
	$('#delRowdtl').on('click', function () {
		let delNo = ordDtlGrid.getCheckedRows()[0].ordDtlCode;
		console.log('ì‚­ì œí• ì£¼ë¬¸ìƒì„¸ë²ˆí˜¸', delNo);
		console.log('ì‚­ì œí•  í–‰ì˜ë²ˆí˜¸', ordDtlGrid.getCheckedRowKeys()[0]);
		ordDtlGrid.removeRow(ordDtlGrid.getCheckedRowKeys()[0]);
		$.ajax({
			url: '/erp/sales/ord/delOrdDtl?ordDtlCode=' + delNo,
			type: 'DELETE',
			success: function (res) {
				console.log('ì‚­ì œ ì„±ê³µ', res);
				Swal.fire({
					title: "ì£¼ë¬¸ì‚­ì œì„±ê³µ!",
					icon: "success",
					draggable: true
				});
			},
			error: function (err) {
				console.error('ì—ëŸ¬ ë°œìƒ', err);
			}
		})
	});
	//ì£¼ë¬¸dtl ìˆ˜ì •í•˜ê¸° 
	$('#modRowdtl').on('click', function () {
		let updDtl = ordDtlGrid.getCheckedRows()[0]; //ì²´í¬ëœ í–‰ì„ ìˆ˜ì •í•¨ ë‹¨ê±´ìˆ˜ì •^^ 
		updDtl.comId = userComId;
		updDtl.quantity = Number(updDtl.quantity);
		updDtl.totPrice = updDtl.totprice;
		
		
		updDtl.ordCode=orderGrid.getCheckedRows()[0].ordCode; //ì£¼ë¬¸ë²ˆí˜¸ ì²´í¬ 
		updDtl.vatPrice=(ordDtlGrid.getCheckedRows()[0].supPrice)/10; //ë¶€ê°€ì„¸ ì„¤ì • 
		updDtl.totPrice=ordDtlGrid.getCheckedRows()[0].supPrice+
										ordDtlGrid.getCheckedRows()[0].vatPrice
										-ordDtlGrid.getCheckedRows()[0].discPrice;
		
		console.log('updDtl', updDtl);
	
		ordDtlGrid.setValue(updDtl.rowkey, "ordCode", orderGrid.getCheckedRows()[0].ordCode);
		console.log('updDtl=>', updDtl);

		$.ajax({
			url: '/erp/sales/ord/updDtl',
			type: 'PUT',
			contentType: 'application/json',
			data: JSON.stringify(updDtl),
			success: function (res) {
				console.log('ì „ì†¡ ì„±ê³µ', res);
				Swal.fire({
					title: "ì£¼ë¬¸ìˆ˜ì •ì„±ê³µ!",
					icon: "success",
					draggable: true
				});
				ordDtlGrid.uncheckAll();
			},
			error: function (err) {
				console.error('ì—ëŸ¬ ë°œìƒ', err);
			}
		});
	})
	//[1:{}] 
	//ordDtlRowì˜ ìˆ˜ëŸ‰ ì…ë ¥ì‹œ ì´ê¸ˆì•¡,ê³µê¸‰ê°€ì•¡,ë¶€ê°€ì„¸ ê³„ì‚°ë˜ì–´ ìë™ì…ë ¥ë¨ 
	ordDtlGrid.on('afterChange', ev => {
		let supPrice = ev.changes[0].value * ordDtlGrid.getRow(ev.changes[0].rowKey).price;
		vdrdiscount=(orderGrid.getCheckedRows()[0].discount)/100;
		let discPrice = (supPrice + supPrice / 10) * vdrdiscount; //í• ì¸ê°€ê²© ê±°ë˜ì²˜ì •ë³´ ë¶ˆëŸ¬ì˜¨ë’¤ ê³„ì‚° ë°˜ì˜	
		if (ev.changes[0].columnName == 'quantity') { //ë°”ë€í–‰ì˜ ì—´ì´ quantity ì¼ë•Œ  
			ordDtlGrid.setValue(ev.changes[0].rowKey, "supPrice", supPrice); //ê³µê¸‰ê°€ì•¡ì˜ ê°€ê²©ì„ (ìˆ˜ëŸ‰*ê°€ê²©) ìœ¼ë¡œ ë°”ê¿ˆ
			ordDtlGrid.setValue(ev.changes[0].rowKey, "vatPrice", supPrice / 10); //ë¶€ê°€ì„¸ë¥¼ ë„˜ê¹€
			ordDtlGrid.setValue(ev.changes[0].rowKey, "totPrice", (supPrice + supPrice / 10) - discPrice); //ì´ê°€ê²©  
			ordDtlGrid.setValue(ev.changes[0].rowKey, "discPrice", Math.floor(discPrice)); //í• ì¸ê¸ˆì•¡
			orderTotprice.set(ev.changes[0].rowKey, Math.floor((supPrice + supPrice / 10) - discPrice));
			console.log('ordDtlGrid.getData()', ordDtlGrid.getData());
			let total = Math.floor(ordDtlGrid.getData().reduce((sum, row) => sum + (row.totPrice || 0), 0));
			orderGrid.setValue(orderGrid.getCheckedRowKeys()[0], "totPrice", total);
		}
	})
	//ëª¨ë‹¬ ê°ì²´ ì„ ì–¸ 
	var modalToggle = document.getElementById('exampleModalToggle')
	var myModal = new bootstrap.Modal(modalToggle, {
		keyboard: false
	})
	//jqueryë¡œ ë°”ê¿”ì¤€í›„  
	$(modalToggle).on('shown.bs.modal', function (e) {
		itemGrid.refreshLayout();
	})
	var myModalEl = document.getElementById('myModal')
	myModalEl.addEventListener('hidden.bs.modal', function (event) {
		// do something...
	})
	//vdrmodal ê°ì²´ë¥¼ ê°€ì ¸ì˜´ 
	var vdrmodalToggle = document.getElementById('vdrModal');
	var vdrmymodal = new bootstrap.Modal(vdrmodalToggle, {
		keyboard: false
	});
	$(vdrmodalToggle).on('shown.bs.modal', function (e) {
		vdrGrid.refreshLayout(); //
	})
	var vdrmyModalEl = document.getElementById('vdrmymodal') //ì—¬ê¸°ì„œ  
	vdrmyModalEl.addEventListener('hidden.bs.modal', function (event) {
		// do something...
	})
	//ì•„ì´í…œì •ë³´ë¥¼ ëŒë ¤ì£¼ëŠ” í•¨ìˆ˜,ëª¨ë‹¬ë²„íŠ¼ ë‹«ìœ¼ë©´ ì›ë˜ ë‚´ê°€ ì„ íƒí•œí–‰ì˜ ë¹ˆì¹¸ì—  
	function itemInfo(itemCode, name, price) {
		//console.log('itemInfoí•¨ìˆ˜í˜¸ì¶œ',itemCode,name,price); 
		return [itemCode, name, price];
	}
	//í–‰ë²ˆí˜¸ ì „ë‹¬í•˜ëŠ” í•¨ìˆ˜ 
	function ordDtlrowNo(rowNo) {
		newOrdRowNo = rowNo;
		return newOrdRowNo;
	}
	//ëª¨ë‹¬ë„ìš°ëŠ”í•¨ìˆ˜ëª¨ìŒ //ì•„ì´í…œëª¨ë‹¬
	function openItemmodal() {
		myModal.show(modalToggle);
	}

	function openVdrmodal() { //ê±°ë˜ì²˜ëª¨ë‹¬ ë„ìš°ëŠ”í•¨ìˆ˜ 
		vdrmymodal.show(vdrmodalToggle);
	}
	//ë‚ ì§œ í¬ë§·ë°”ê¾¸ëŠ” í•¨ìˆ˜ Sun May 30 2021 15:47:29 GMT+0900 (ëŒ€í•œë¯¼êµ­ í‘œì¤€ì‹œ) => yyyy-MM-dd 
	function dateformatyymmdd(today) {
		var today = today;
		var year = today.getFullYear();
		var month = ('0' + (today.getMonth() + 1)).slice(-2);
		var day = ('0' + today.getDate()).slice(-2);
		var dateString = year + '-' + month + '-' + day;
		return dateString;
	}
	//  
	function hyphenToSlash(dateStr) {
		if (typeof dateStr !== 'string') return '';
		return dateStr.replace(/-/g, '/');
	}

	function getdtlplusInfo(item) { //getdtlplusInfo 
		const info = ordDtlGrid.getRow(item);
		return info;
	}
	function getOrdHeadplusInfo(newNo) {
		const info = orderGrid.getRow(newNo);
		return info;
	}
		const topOptions = {
			  includeHiddenColumns: true,
			  onlySelected: false,
			  fileName: 'ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ',
			};
	$('#excel').on('click',function(){
		 orderGrid.export('xlsx',topOptions); 
	})
	function formatItemType(status){
			for(let i=0;i<itemType.length;i++){
				if(itemType[i].subCode==status){
					return itemType[i].subName;
				}
			}
	}


	//ì£¼ë¬¸ë“±ë¡ í• ë•Œ ì´ê±° ì£¼ì„ì²˜ë¦¬ í•˜ë©´ ì•ˆë„˜ì–´ê°;; 

	 const userID = [[${#authentication.principal != 'anonymousUser' ? #authentication.principal.userId : 'c1005'}]];
	 const userName = [[${#authentication.principal != 'anonymousUser' ? #authentication.principal.empName : 'ì •ì€ì• '	}]];
	 const userComId = [[${#authentication.principal != 'anonymousUser' ? #authentication.principal.comId : 'com-101'	}]];
//	console.log(userID, userName, userComId);
</script>
</html>