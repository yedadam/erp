<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layouts/default_layout}"
      layout:fragment="Content"
      lang="ko">
<head>
    <title>ì†Œìƒê³µì¸ ERP - ê¸‰ì—¬ê´€ë¦¬</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tui-grid/4.21.17/tui-grid.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        .dashboard-container {
            max-width: 90vw;
            margin: 40px auto;
            padding: 32px 40px;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 32px rgba(102,126,234,0.08);
        }
        .dashboard-header {
            background: linear-gradient(90deg, #7b8cff 0%, #8f6ed5 100%);
            color: #fff;
            padding: 24px 32px 16px 32px;
            border-radius: 16px 16px 0 0;
            margin-bottom: 32px;
        }
        .dashboard-header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .dashboard-header .nav-breadcrumb {
            font-size: 1rem;
            opacity: 0.95;
        }
        .summary-cards {
            display: flex;
            gap: 24px;
            margin-bottom: 32px;
        }
        .summary-card {
            flex: 1;
            background: #f8fafc;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 2px 12px rgba(102,126,234,0.06);
        }
        .summary-card h3 {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 8px;
        }
        .summary-card .amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }
        .filter-panel {
            background: #f5f7fa;
            border-radius: 12px;
            padding: 20px 24px;
            margin-bottom: 24px;
            display: flex;
            gap: 24px;
            align-items: flex-end;
        }
        .filter-panel .form-group {
            margin-bottom: 0;
        }
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 18px;
        }
        .tui-grid-container {
            margin-bottom: 32px;
        }
        .badge-status {
            font-size: 0.95em;
            padding: 4px 14px;
            border-radius: 12px;
            font-weight: 600;
        }
        .badge-paid { background: #4caf50; color: #fff; }
        .badge-pending { background: #ffb300; color: #fff; }
        .badge-error { background: #e57373; color: #fff; }
        .swal2-popup { font-size: 1.1rem !important; }
        /* ì¹´ë“œì™€ TOAST UI Grid ëª¨ë‘ ìƒë‹¨ ë¼ìš´ë“œ 8pxë¡œ í†µì¼ */
        .table-container,
        #payrollGrid .tui-grid-container,
        #payrollGrid .tui-grid-table,
        #payrollGrid .tui-grid-header-area {
          border-top-left-radius: 8px !important;
          border-top-right-radius: 8px !important;
        }
        /* TOAST UI Grid ë‚´ë¶€ í…Œì´ë¸”ì—ë„ ì ìš© */
        #payrollGrid .tui-grid-table {
          border-radius: 8px 8px 0 0 !important;
        }
        /* í•„ìš”ì‹œ, í•˜ë‹¨ ë¼ìš´ë“œëŠ” 0ìœ¼ë¡œ */
        #payrollGrid .tui-grid-container,
        #payrollGrid .tui-grid-table,
        #payrollGrid .tui-grid-header-area {
          border-bottom-left-radius: 0 !important;
          border-bottom-right-radius: 0 !important;
        }
        /* TOAST UI Grid ìƒë‹¨ ë¼ìš´ë“œ - ê¸‰ì—¬í•­ëª©ê´€ë¦¬ì™€ ë™ì¼í•˜ê²Œ ì ìš© */
        #payrollGrid.tui-grid-container {
            border-radius: 8px 8px 0 0 !important;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="container" style="max-width:1400px; margin:0 auto; padding:20px;">
        <!-- í—¤ë” -->
        <div class="header" style="background:white; border-radius:12px; padding:20px 30px; margin-bottom:24px; box-shadow:0 2px 10px rgba(0,0,0,0.1); display:flex; justify-content:space-between; align-items:center;">
            <h1 style="font-size:28px; font-weight:700; color:#1d1d1f;">ê¸‰ì—¬ê´€ë¦¬</h1>
            <div class="header-actions" style="display:flex; gap:12px;">
                <button class="btn btn-secondary" id="exportPayrollBtn">ğŸ“Š ê¸‰ì—¬ëŒ€ì¥ ë‚´ë³´ë‚´ê¸°</button>
                <button class="btn btn-primary" id="addPayrollBtn">â• ê¸‰ì—¬ ìƒì„±</button>
            </div>
        </div>
        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="stats-grid" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; margin-bottom:30px;">
            <div class="stat-card" style="background:white; border-radius:12px; padding:24px; box-shadow:0 2px 10px rgba(0,0,0,0.1);">
                <h3 style="font-size:14px; color:#666; margin-bottom:8px; font-weight:500;">ì´ë²ˆ ë‹¬ ì´ ê¸‰ì—¬</h3>
                <div class="value" id="totalPay" style="font-size:28px; font-weight:700; color:#1d1d1f; margin-bottom:8px;">â‚©45,600,000</div>
                <div class="change" style="font-size:12px; color:#34C759; font-weight:500;">+5.2% ì „ì›” ëŒ€ë¹„</div>
            </div>
            <div class="stat-card" style="background:white; border-radius:12px; padding:24px; box-shadow:0 2px 10px rgba(0,0,0,0.1);">
                <h3 style="font-size:14px; color:#666; margin-bottom:8px; font-weight:500;">ì§€ê¸‰ ì™„ë£Œ</h3>
                <div class="value" id="paidCount" style="font-size:28px; font-weight:700; color:#1d1d1f; margin-bottom:8px;">23ëª…</div>
                <div class="change" style="font-size:12px; color:#34C759; font-weight:500;">ì „ì²´ ëŒ€ìƒì 25ëª… ì¤‘</div>
            </div>
            <div class="stat-card" style="background:white; border-radius:12px; padding:24px; box-shadow:0 2px 10px rgba(0,0,0,0.1);">
                <h3 style="font-size:14px; color:#666; margin-bottom:8px; font-weight:500;">ë¯¸ì§€ê¸‰</h3>
                <div class="value" id="unpaidCount" style="font-size:28px; font-weight:700; color:#1d1d1f; margin-bottom:8px;">2ëª…</div>
                <div class="change" style="font-size:12px; color:#34C759; font-weight:500;">ì¡°ì†í•œ ì²˜ë¦¬ í•„ìš”</div>
            </div>
            <div class="stat-card" style="background:white; border-radius:12px; padding:24px; box-shadow:0 2px 10px rgba(0,0,0,0.1);">
                <h3 style="font-size:14px; color:#666; margin-bottom:8px; font-weight:500;">í‰ê·  ê¸‰ì—¬</h3>
                <div class="value" id="avgPay" style="font-size:28px; font-weight:700; color:#1d1d1f; margin-bottom:8px;">â‚©1,824,000</div>
                <div class="change" style="font-size:12px; color:#34C759; font-weight:500;">+2.1% ì „ì›” ëŒ€ë¹„</div>
            </div>
        </div>
        <!-- í•„í„° ì„¹ì…˜ -->
        <div class="filter-section" style="background:white; border-radius:12px; padding:24px; margin-bottom:24px; box-shadow:0 2px 10px rgba(0,0,0,0.1);">
            <div class="filter-row d-flex align-items-center flex-wrap gap-3">
                <div class="filter-group">
                    <label>ê¸°ê°„</label>
                    <select class="form-select" id="payroll-month" style="min-width:120px;">
                        <option value="2024-12">2024ë…„ 12ì›”</option>
                        <option value="2024-11">2024ë…„ 11ì›”</option>
                        <option value="2024-10">2024ë…„ 10ì›”</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ë¶€ì„œ</label>
                    <select class="form-select" id="department" style="min-width:100px;">
                        <option value="all">ì „ì²´</option>
                        <option value="dev">ê°œë°œíŒ€</option>
                        <option value="sales">ì˜ì—…íŒ€</option>
                        <option value="admin">ê´€ë¦¬íŒ€</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ìƒíƒœ</label>
                    <select class="form-select" id="status" style="min-width:100px;">
                        <option value="all">ì „ì²´</option>
                        <option value="paid">ì§€ê¸‰ì™„ë£Œ</option>
                        <option value="approved">ìŠ¹ì¸</option>
                        <option value="pending">ëŒ€ê¸°</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ì§ì›ëª…</label>
                    <input type="text" class="form-control" id="searchInput" placeholder="ì§ì›ëª… ê²€ìƒ‰" style="min-width:180px;">
                </div>
                <div class="filter-group align-self-end">
                    <label>&nbsp;</label>
                    <button class="btn btn-primary" id="searchBtn" style="min-width:60px;">ê²€ìƒ‰</button>
                </div>
            </div>
        </div>
        <!-- ê¸‰ì—¬ ëª©ë¡ + Toast UI Grid -->
        <div class="table-container" style="background:white; border-radius:12px; overflow:hidden; box-shadow:0 2px 10px rgba(0,0,0,0.1);">
            <div class="table-header" style="padding:20px 24px; border-bottom:1px solid #e5e5e7; display:flex; justify-content:space-between; align-items:center;">
                <h2 style="font-size:20px; font-weight:600; color:#1d1d1f;">ê¸‰ì—¬ ëª©ë¡</h2>
                <div class="table-actions" style="display:flex; gap:12px;">
                    <button class="btn btn-secondary btn-small" id="bulkApproveBtn">ì¼ê´„ ìŠ¹ì¸</button>
                    <button class="btn btn-secondary btn-small" id="bulkPayBtn">ì¼ê´„ ì§€ê¸‰</button>
                </div>
            </div>
            <div id="payrollGrid" class="tui-grid-container"></div>
        </div>
        <!-- í˜ì´ì§€ë„¤ì´ì…˜ì€ Toast UI Grid ë‚´ì¥ ì‚¬ìš© -->
    </div>
    <!-- Toast UI Grid, SweetAlert2, Bootstrap ë“± ìŠ¤í¬ë¦½íŠ¸ëŠ” ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€ -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tui-grid/4.21.17/tui-grid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
// ===================== ìƒë‹¨ ëŒ€ì‹œë³´ë“œ/ë²„íŠ¼ ì˜ì—­ (1/4) =====================
// (ê¸°ì¡´ í†µê³„ ì¹´ë“œ, ì£¼ìš” ë²„íŠ¼ ì˜ì—­ì€ ê·¸ëŒ€ë¡œ ìœ ì§€)

// ===================== í•˜ë‹¨ ê¸‰ì—¬ëª…ì„¸ ëª©ë¡ (3/4) =====================
// ToastUI Grid - ì‹¤ì œ API ì—°ë™ êµ¬ì¡°ë¡œ ë¦¬íŒ©í† ë§

// ê·¸ë¦¬ë“œ ê°ì²´ ì „ì—­ ì„ ì–¸
let grid;

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
$(document).ready(function() {
  // ê·¸ë¦¬ë“œ ìƒì„±
  grid = new tui.Grid({
    el: document.getElementById('payrollGrid'),
    data: [], // ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”, ë”ë¯¸ ë°ì´í„° ì™„ì „ ì œê±°
    rowHeaders: ['checkbox'],
    scrollX: false,
    scrollY: true,
    minBodyHeight: 350,
    columns: [
      { header: 'No.', name: 'no', width: 50, align: 'center' },
      { header: 'ì§ì›ëª…', name: 'empName', width: 100, align: 'center' },
      { header: 'ë¶€ì„œ', name: 'dept', width: 100, align: 'center' },
      { header: 'ì§ê¸‰', name: 'position', width: 120, align: 'center' },
      { header: 'ê¸‰ì—¬ì›”', name: 'calcMonth', width: 90, align: 'center' },
      { header: 'ê¸°ë³¸ê¸‰', name: 'baseSal', width: 110, align: 'right', formatter: ({value}) => value ? value.toLocaleString()+'ì›' : '' },
      { header: 'ìˆ˜ë‹¹', name: 'allowance', width: 90, align: 'right',
        formatter: ({row}) => {
          // ìˆ˜ë‹¹ í•©ê³„: BONUS + OT_ALLOW + HOLI_ALLOW + MEAL_ALLOW
          const sum = (row.bonus||0)+(row.otAllow||0)+(row.holiAllow||0)+(row.mealAllow||0);
          return sum ? sum.toLocaleString()+'ì›' : '';
        }
      },
      { header: 'ê³µì œì•¡', name: 'deduction', width: 100, align: 'right',
        formatter: ({row}) => {
          // ê³µì œ í•©ê³„: INC_TAX + EMP_INSUR + HEALTH_INSUR + LTC_INSUR + NAT_PENSION
          const sum = (row.incTax||0)+(row.empInsur||0)+(row.healthInsur||0)+(row.ltcInsur||0)+(row.natPension||0);
          return sum ? sum.toLocaleString()+'ì›' : '';
        }
      },
      { header: 'ì‹¤ì§€ê¸‰ì•¡', name: 'netSalary', width: 120, align: 'right', formatter: ({value}) => value ? '<b>'+value.toLocaleString()+'ì›</b>' : '' },
      { header: 'ìƒíƒœ', name: 'status', width: 90, align: 'center', formatter: ({value}) => renderStatusBadge(value) },
      { header: 'ì§€ê¸‰ì¼', name: 'payDate', width: 100, align: 'center' },
      { header: 'ê´€ë¦¬', name: 'actions', width: 120, align: 'center',
        formatter: () => `<button class='btn btn-primary btn-sm' style='font-size:13px;padding:4px 12px;margin-right:4px;'>ìˆ˜ì •</button><button class='btn btn-secondary btn-sm' style='font-size:13px;padding:4px 12px;background:#f5f6fa;color:#333;border:none;'>ì‚­ì œ</button>`
      }
    ],
    pageOptions: { useClient: true, perPage: 10 }
  });

  // ìµœì´ˆ ë¡œë”© ì‹œ ë°ì´í„° ì¡°íšŒ
  loadPayrollList();

  // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ
  $('#searchBtn').on('click', function() {
    loadPayrollList();
  });

  // í•„í„°(ê¸°ê°„/ë¶€ì„œ/ìƒíƒœ/ì§ì›ëª…) ë³€ê²½ ì‹œ ìë™ ì¡°íšŒ(ì„ íƒ ì ìš©)
  $('#payroll-month, #department, #status').on('change', function() {
    loadPayrollList();
  });
  $('#searchInput').on('keydown', function(e) {
    if (e.keyCode === 13) loadPayrollList();
  });
});

// ê¸‰ì—¬ëª…ì„¸ ëª©ë¡ ì‹¤ì œ API ì—°ë™ í•¨ìˆ˜
function loadPayrollList() {
  const params = {
    calcMonth: $('#payroll-month').val(),
    keyword: $('#searchInput').val(),
    // dept: $('#department').val(), // ì¶”í›„ í™•ì¥
    // status: $('#status').val(),   // ì¶”í›„ í™•ì¥
    // empId, comId ë“±ì€ í•„ìš”ì‹œ ì¶”ê°€
  };
  $.ajax({
    url: '/erp/hr/salary/list-data', // ë°±ì—”ë“œì™€ URL/ë°©ì‹ í†µì¼ (GET)
    type: 'GET',
    data: params,
    success: function(res) {
      // resê°€ ë°°ì—´ì´ë©´ ë°”ë¡œ ë°”ì¸ë”©, ì•„ë‹ˆë©´ ë¹ˆ ë°°ì—´
      if (Array.isArray(res)) {
        grid.resetData(res);
      } else if (Array.isArray(res.data)) {
        grid.resetData(res.data);
      } else {
        grid.resetData([]);
      }
    },
    error: function(xhr, status, error) {
      grid.resetData([]);
      Swal.fire('ì˜¤ë¥˜', 'ê¸‰ì—¬ëª…ì„¸ ëª©ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
    }
  });
}

// ìƒíƒœ ë±ƒì§€ ë Œë”ë§ í•¨ìˆ˜(íŒ€ì¥ ìŠ¤íƒ€ì¼)
function renderStatusBadge(status) {
  if(status === 'ì§€ê¸‰ì™„ë£Œ') return '<span style="background:#e6f4ea;color:#1a7f37;padding:4px 14px;border-radius:12px;font-size:13px;font-weight:600;">ì§€ê¸‰ì™„ë£Œ</span>';
  if(status === 'ìŠ¹ì¸') return '<span style="background:#e6f4fa;color:#1a7f37;padding:4px 14px;border-radius:12px;font-size:13px;font-weight:600;">ìŠ¹ì¸</span>';
  if(status === 'ëŒ€ê¸°') return '<span style="background:#faeaea;color:#d93025;padding:4px 14px;border-radius:12px;font-size:13px;font-weight:600;">ëŒ€ê¸°</span>';
  return status;
}
    </script>
</body>
</html> 