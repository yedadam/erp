<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layouts/main_layout}"
      layout:fragment="MainContent">
<head>
  <meta charset="UTF-8">
  <title>요금제</title>
   <link th:href="@{/main_css/subscribe.css}" rel="stylesheet">
</head>
<body>
<div class="container my-5 realContainer">
  <div class="pricing-header">
    <h3>요금제 선택</h3>
    <p class="text-muted">필요한 기능에 맞춰 요금제를 선택해보세요.</p>
  </div>

  <div class="row g-4 text-center">
    <div class="col-md-4">
      <div class="plan-card h-100">
        <h4>Lite</h4>
        <p class="text-muted">인사 + 회계</p>
        <p>구독 기간</p>
        <select class="form-select text-center during"><option>30일</option></select>
        <p>사원수</p>
        <select class="form-select text-center howMany"><option>50명</option></select>
        <p>구독타입</p>
        <select class="form-select text-center subsType">
          <option>-선택-</option>
          <option>정기구독</option>
          <option>기간구독</option>
        </select>
        <p class="desc">기본적인 기능만 제공되는 최소형 요금제입니다.</p>
        <p class="price">60,000 <span style="font-size: 0.8rem;">원</span></p>
        <button class="pay-btn">결제하기</button>
      </div>
    </div>

    <div class="col-md-4">
      <div class="plan-card h-100">
        <h4>Standard</h4>
        <p class="text-muted">재고 + 영업</p>
        <p>구독 기간</p>
        <select class="form-select text-center during"><option>30일</option></select>
        <p>사원수</p>
        <select class="form-select text-center howMany"><option>50명</option></select>
        <p>구독타입</p>
        <select class="form-select text-center subsType">
          <option>-선택-</option>
          <option>정기구독</option>
          <option>기간구독</option>
        </select>
        <p class="desc">중간 규모 기업을 위한 재고/영업 포함 요금제</p>
        <p class="price">90,000 <span style="font-size: 0.8rem;">원</span></p>
        <button class="pay-btn">결제하기</button>
      </div>
    </div>

    <div class="col-md-4">
      <div class="plan-card h-100">
        <h4>Premium</h4>
        <p class="text-muted">모든 기능 포함</p>
        <p>구독 기간</p>
        <select class="form-select text-center during"><option>30일</option></select>
        <p>사원수</p>
        <select class="form-select text-center howMany"><option>50명</option></select>
        <p>구독타입</p>
        <select class="form-select text-center subsType">
          <option>-선택-</option>
          <option>정기구독</option>
          <option>기간구독</option>
        </select>
        <p class="desc">ERP의 모든 기능을 자유롭게 사용할 수 있습니다.</p>
        <p class="price">120,000 <span style="font-size: 0.8rem;">원</span></p>
        <button class="pay-btn">결제하기</button>
      </div>
    </div>
  </div>
</div>

<!-- 모달 -->
<div id="paymentModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal-content">
    <div class="modal-header">
      <button class="modal-close" aria-label="Close modal">&times;</button>
      <div id="modalTitle">ERP 시스템 이용계약서</div>
    </div>
    <div class="contract-document" id="contractContent"></div>
    <div class="contract-footer">
      <button id="confirmPaymentBtn" class="confirm-btn">위 계약 내용에 동의하며 결제를 진행합니다</button>
    </div>
  </div>
</div>

<script>
  //모달창
  let modal = document.getElementById('paymentModal');
  //모달닫기
  let closeBtn = modal.querySelector('.modal-close');
  //결제진행 버튼
  let confirmBtn = document.getElementById('confirmPaymentBtn');
  //
  let contractContent = document.getElementById('contractContent');
  
  //계약서 header
  let constractHeader = `
  <div class="contract-title">ERP 시스템 이용계약서 (Lite 요금제)</div>
    <div class="contract-subtitle">Enterprise Resource Planning System Service Agreement</div>

    <div class="contract-section">
      <div class="contract-section-title">제1조 (계약 당사자 및 서비스 개요)</div>
      <div class="contract-article">
        <div class="contract-article-number">1. 서비스 제공자:</div>
        <div class="contract-content">㈜ERP솔루션 (이하 "회사")</div>
      </div>
      <div class="contract-article">
        <div class="contract-article-number">2. 서비스 이용자:</div>
        <div class="contract-content">본 계약에 동의하는 개인 또는 법인 (이하 "이용자")</div>
      </div>
      <div class="contract-article">
        <div class="contract-article-number">3. 서비스 내용:</div>
        <div class="contract-content"><span class="highlight">Lite 요금제</span> - 인사관리 및 회계관리 기능 제공</div>
      </div>
    </div>`;
 //계약서 footer
  let constractFooter = `
    <div class="contract-section">
    <div class="contract-section-title">제3조 (결제 및 환불 정책)</div>
    <div class="contract-article">
      <div class="contract-article-number">1. 결제 방법:</div>
      <div class="contract-content">신용카드, 계좌이체를 통한 자동결제</div>
    </div>
    <div class="contract-article">
      <div class="contract-article-number">2. 환불 정책:</div>
      <div class="contract-content">서비스 첫 결제 후 <span class="highlight">7일 이내 전액 환불</span> 가능 (단, 서비스 이용 실적이 없는 경우에 한함)</div>
    </div>
    <div class="contract-article">
      <div class="contract-article-number">3. 계약 해지:</div>
      <div class="contract-content">언제든 해지 가능하며, 해지 시점부터 서비스 이용 중단</div>
    </div>
  </div>

  <div class="contract-section">
    <div class="contract-section-title">제4조 (서비스 제공 및 제한)</div>
    <div class="contract-article">
      <div class="contract-article-number">1. 서비스 가용성:</div>
      <div class="contract-content">연중무휴 24시간 서비스 제공 (정기점검 시간 제외)</div>
    </div>
    <div class="contract-article">
      <div class="contract-article-number">2. 데이터 보안:</div>
      <div class="contract-content">SSL 암호화 및 정기 백업을 통한 데이터 보호</div>
    </div>
    <div class="contract-article">
      <div class="contract-article-number">3. 고객지원:</div>
      <div class="contract-content">평일 09:00-18:00 이메일 및 전화 지원</div>
    </div>
  </div>

  <div class="contract-date">계약 체결일: ${new Date().toLocaleDateString('ko-KR')}</div>

  <div class="contract-signature">
    <div class="signature-box">
      <div>서비스 제공자</div>
      <div style="margin-top: 20px;">㈜ERP솔루션</div>
    </div>
    <div class="signature-box">
        <div>서비스 이용자 (전자서명)</div>
        <canvas id="canvas" width="400" height="200"></canvas>
        <button class="clear-signature-btn" type="button">서명 초기화</button>
    </div>
  </div>
  `;
  
  let defaultConst = null
 //계약서 렌더링
 function constFunc(type,pay,during,subsType,howMany,useFunc){
    defaultConst =  `${constractHeader}
     <div class="contract-section">
      <div class="contract-section-title">제2조 (서비스 이용 조건)</div>
      <table class="contract-table">
        <tr>
          <th>구분</th>
          <th>내용</th>
        </tr>
        <tr>
          <td>요금제</td>
          <td>${type}</td>
        </tr>
        <tr>
          <td>월 이용료</td>
          <td>${pay}</td>
        </tr>
        <tr>
          <td>기간</td>
          <td>${during}</td>
        </tr>
        <tr>
          <td>구독타입</td>
          <td>${subsType}</td>
        </tr>
        <tr>
          <td>이용자 수</td>
          <td>${howMany}</td>
        </tr>
        <tr>
          <td>제공 기능</td>
          <td>${useFunc}</td>
        </tr>
      </table>
    </div>
    ${constractFooter}
    `
    return defaultConst;
 } 

  //계약서 모달 버튼
  $('.pay-btn').on('click', function () {
	//해당버튼의 인덱스번호 갖고오기
    const index = $('.pay-btn').index(this);
	//각 클래스 인덱스의 텍스트값 가져오기
    let type = $('.plan-card h4').eq(index).text();
    let pay = $('.plan-card .price').eq(index).text();
    let during = $('.plan-card .during').eq(index).val();
    let subsType = $('.plan-card .subsType').eq(index).val();
    let howMany = $('.plan-card .howMany').eq(index).val();
    let useFunc = $('.plan-card .desc').eq(index).text();
    
	//계약서 렌더링 해서 innerHTML안에 값넣기
    contractContent.innerHTML = constFunc(type, pay, during, subsType, howMany, useFunc);
	//모달창 열기
    modal.style.display = 'block';

    // 서명 패드 초기화 및 생성
    const canvas = document.getElementById('canvas');
    const signaturePad = new SignaturePad(canvas, {
      penColor: 'black',
      backgroundColor: 'rgba(255,255,255,0)'
    });

    // 초기화 버튼 이벤트 등록
    document.querySelector('.clear-signature-btn').onclick = () => {
      signaturePad.clear();
    };

    // confirmBtn 클릭 시 서명 확인 예시
    confirmBtn.onclick = () => {
      if (signaturePad.isEmpty()) {
        alert('전자서명을 해주세요.');
      } else {
        // 서명 이미지 데이터 얻기 (예: 서버 전송 등)
        const dataURL = signaturePad.toDataURL();
        console.log('서명 이미지:', dataURL);
        alert('결제가 진행됩니다.');
        modal.style.display = 'none';
      }
    };
  });

  // 모달 닫기 버튼
  closeBtn.addEventListener('click', () => {
    modal.style.display = 'none';
  });

  // 모달 바깥 클릭시 모달 닫기
  window.addEventListener('click', (event) => {
    if (event.target === modal) {
      modal.style.display = 'none';
    }
  });
</script>
</body>
</html>