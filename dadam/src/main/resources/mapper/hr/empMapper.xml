<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dadam.hr.emp.mapper.EmpMapper">

    <!-- 사원 전체 조회 -->
    <select id="findEmpList" resultType="com.dadam.hr.emp.service.EmpVO" parameterType="map">
        SELECT
            e.emp_id,
            e.com_id,
            e.dept_code,
            d.dept_name,
            e.pwd,
            e.emp_name,
            e.email,
            e.tel,
            e.addr,
            e.hire_date,
            e.position,
            e.resign_date,
            e.emp_status,
            e.work_type,
            e.resign_reason,
            e.sal,
            e.bank,
            e.acct_no,
            e.birth_date,
            e.profile_img_path,
            e.note
        FROM employees e
        LEFT JOIN departments d ON e.dept_code = d.dept_code
        <where>
            <if test="keyword != null and keyword != ''">
                (e.emp_id LIKE CONCAT('%', #{keyword}, '%')
                OR e.emp_name LIKE CONCAT('%', #{keyword}, '%')
                OR d.dept_name LIKE CONCAT('%', #{keyword}, '%'))
            </if>
            <if test="status != null and status != ''">
                AND e.emp_status = #{status}
            </if>
        </where>
        ORDER BY e.emp_id
    </select>

    <!-- 사원 상세 조회 -->
    <select id="findEmpDetail" parameterType="string" resultType="com.dadam.hr.emp.service.EmpVO">
        SELECT
            e.emp_id,
            e.com_id,
            e.dept_code,
            d.dept_name,
            e.pwd,
            e.emp_name,
            e.email,
            e.tel,
            e.addr,
            e.hire_date,
            e.position,
            e.resign_date,
            e.emp_status,
            e.work_type,
            e.resign_reason,
            e.sal,
            e.bank,
            e.acct_no,
            e.birth_date,
            e.profile_img_path,
            e.note
        FROM employees e
        JOIN departments d ON e.dept_code = d.dept_code
        WHERE e.emp_id = #{empId}
    </select>

    <!-- 사원 등록 -->
    <insert id="insertEmp" parameterType="com.dadam.hr.emp.service.EmpVO">
        INSERT INTO EMPLOYEES (
            EMP_ID, COM_ID, DEPT_CODE, PWD, EMP_NAME, EMAIL, TEL,
            HIRE_DATE, POSITION, EMP_STATUS, WORK_TYPE, ADDR
        ) VALUES (
            #{empId}, #{comId}, #{deptCode}, #{pwd}, #{empName}, #{email}, #{tel},
            CURDATE(), #{position}, #{empStatus}, #{workType}, #{addr}
        )
    </insert>

    <!-- 사원 수정 -->
    <update id="updateEmp" parameterType="com.dadam.hr.emp.service.EmpVO">
        UPDATE EMPLOYEES
        SET
            DEPT_CODE = #{deptCode},
            EMP_NAME = #{empName},
            EMAIL = #{email},
            TEL = #{tel},
            POSITION = #{position},
            EMP_STATUS = #{empStatus},
            WORK_TYPE = #{workType},
            ADDR = #{addr}
            -- 필요한 다른 필드들 추가
        WHERE EMP_ID = #{empId}
    </update>

    <!-- 사원 삭제 (논리적 삭제: 퇴사 처리) -->
    <update id="deleteEmp" parameterType="string">
        UPDATE EMPLOYEES
        SET
            EMP_STATUS = 'stt02', -- '퇴사' 상태 코드
            RESIGN_DATE = CURDATE()
        WHERE EMP_ID = #{empId}
    </update>

</mapper> 