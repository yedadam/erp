<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dadam.hr.salary.mapper.SalaryStatementMapper">
    <!-- 급여명세서 전체 목록 조회 (실제 Oracle 테이블 구조) -->
    <select id="selectSalaryStatementList" resultType="SalaryStatementVO">
        SELECT
            s.SAL_ID,
            s.EMP_ID,
            s.COM_ID,
            s.CALC_MONTH AS payMonth,
            s.BASE_SAL AS baseSalary,
            s.BONUS,
            s.MEAL_ALLOW,
            s.INC_TAX,
            s.NAT_PENSION,
            s.HEALTH_INSUR,
            s.EMP_INSUR,
            s.LTC_INSUR,
            s.NET_SALARY AS netPay,
            s.STATUS,
            e.EMP_NAME AS empName
        FROM SALARYSTATEMENT s
        JOIN EMPLOYEES e ON s.EMP_ID = e.EMP_ID AND s.COM_ID = e.COM_ID
        WHERE s.EMP_ID = #{empId}
          AND s.COM_ID = #{comId}
          AND s.CALC_MONTH >= TO_CHAR(ADD_MONTHS(SYSDATE, -2), 'YYYYMM')
        ORDER BY s.CALC_MONTH DESC
    </select>
    <!-- 단일 급여명세서 상세 조회 (SAL_ID 기준) -->
    <select id="selectSalaryStatementById" parameterType="map" resultType="SalaryStatementVO">
        SELECT
            s.*,
            e.EMP_NAME AS empName
        FROM SALARYSTATEMENT s
        JOIN EMPLOYEES e ON s.EMP_ID = e.EMP_ID AND s.COM_ID = e.COM_ID
        WHERE s.SAL_ID = #{salId}
          AND s.COM_ID = #{comId}
    </select>
    <!-- 급여명세서 등록 -->
    <insert id="insertSalaryStatement" parameterType="SalaryStatementVO">
        INSERT INTO salaryStatement (
            emp_id, pay_month, base_salary, salary1, salary2, salary3, salary4, salary5, salary6, salary7, salary8, salary9, salary10, allowance_total, deduction_total, attendance, net_pay, created_date, updated_date
        ) VALUES (
            #{empId}, #{payMonth}, #{baseSalary}, #{salary1}, #{salary2}, #{salary3}, #{salary4}, #{salary5}, #{salary6}, #{salary7}, #{salary8}, #{salary9}, #{salary10}, #{allowanceTotal}, #{deductionTotal}, #{attendance}, #{netPay}, NOW(), NOW()
        )
    </insert>
    <!-- 급여명세서 수정 -->
    <update id="updateSalaryStatement" parameterType="SalaryStatementVO">
        UPDATE salaryStatement
        SET base_salary = #{baseSalary}, salary1 = #{salary1}, salary2 = #{salary2}, salary3 = #{salary3}, salary4 = #{salary4}, salary5 = #{salary5}, salary6 = #{salary6}, salary7 = #{salary7}, salary8 = #{salary8}, salary9 = #{salary9}, salary10 = #{salary10}, allowance_total = #{allowanceTotal}, deduction_total = #{deductionTotal}, attendance = #{attendance}, net_pay = #{netPay}, updated_date = NOW()
        WHERE id = #{id} AND com_id = #{comId}
    </update>
    <!-- 급여명세서 삭제 -->
    <delete id="deleteSalaryStatement" parameterType="map">
        DELETE FROM salaryStatement WHERE id = #{id} AND com_id = #{comId}
    </delete>
</mapper> 