<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dadam.hr.attendance.mapper.AttendanceMapper">

    <!-- [출근 등록] 출근 정보 등록 -->
    <insert id="insertCheckIn" parameterType="map">
        INSERT INTO attendance (
            attendance_code, com_id, emp_id, work_date, standard_start_time, actual_start_time, check_ip, status, created_at
        ) VALUES (
            #{attendanceCode}, #{comId}, #{empId}, #{workDate}, #{standardStartTime}, #{actualStartTime}, #{checkIp}, #{status}, #{createdAt}
        )
    </insert>

    <!-- [퇴근 처리] 퇴근 정보 업데이트 -->
    <update id="updateCheckOut" parameterType="map">
        UPDATE attendance
        SET actual_end_time = #{actualEndTime},
            standard_end_time = #{standardEndTime},
            overtime_hrs = #{overtimeHrs},
            updated_at = #{updatedAt}
        WHERE attendance_code = #{attendanceCode}
          AND com_id = #{comId}
    </update>

    <!-- [오늘 근태 조회] 당일 근태 정보 조회 -->
    <select id="selectTodayAttendance" parameterType="map" resultType="AttendanceVO">
        SELECT * FROM attendance
        WHERE emp_id = #{empId}
          AND work_date = #{workDate}
          AND com_id = #{comId}
    </select>

    <!-- [출근기록 존재여부] 출근기록 중복 체크 -->
    <select id="existsCheckIn" parameterType="map" resultType="boolean">
        SELECT CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END
        FROM attendance
        WHERE emp_id = #{empId}
          AND work_date = #{workDate}
          AND com_id = #{comId}
    </select>

    <!-- [근태 목록 조회] 기간별 근태 리스트 조회 -->
    <select id="selectAttendanceList" parameterType="map" resultType="AttendanceVO">
        SELECT * FROM attendance
        WHERE com_id = #{comId}
          AND emp_id = #{empId}
          AND work_date BETWEEN #{fromDate} AND #{toDate}
        ORDER BY work_date DESC
    </select>

</mapper> 